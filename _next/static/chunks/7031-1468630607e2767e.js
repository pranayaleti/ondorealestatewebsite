"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7031],{47031:(e,t,r)=>{r.d(t,{AuthProvider:()=>p,A:()=>f});var s=r(95155),a=r(12115),n=r(20063),o=r(79733),i=r(61465);let c=new Map;async function u(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s="user:".concat(e,":").concat(t||"");if(r){let e=c.get(s);if(e&&Date.now()-e.timestamp<3e5)return e.result}try{let a=await fetch("".concat((0,o.E)("/api/blacklist/check")),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"user",value:e,email:t})});if(!a.ok)return{isBlacklisted:!1,type:"user"};let n=await a.json(),i=n.success?n.data:{isBlacklisted:!1,type:"user"};return r&&c.set(s,{result:i,timestamp:Date.now()}),i}catch(e){return{isBlacklisted:!1,type:"user"}}}let l=(0,a.createContext)(void 0),d="ondo_auth_token",m="ondo_user_data",h=new i.v$(5,3e5);function p(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[p,f]=(0,a.useState)(!0),w=(0,n.useRouter)();(0,a.useEffect)(()=>{(async()=>{let e=i.Bu.getItem(d),t=i.Bu.getItem(m);if(e&&t)try{let r=JSON.parse(t);await g(e)?c({...r,token:e}):(i.Bu.removeItem(d),i.Bu.removeItem(m))}catch(e){i.Bu.removeItem(d),i.Bu.removeItem(m)}f(!1)})()},[]);let g=async e=>{try{let t=await fetch((0,o.E)("/api/auth/verify"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!t.ok)return await t.json().catch(()=>({})),!1;return!0}catch(e){return!1}},v=async()=>{let e=i.Bu.getItem(d);if(!e)return!1;try{let t=await fetch((0,o.E)("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();if(e.token){let t=i.Bu.setItem(d,e.token);return t&&r&&c({...r,token:e.token}),t}}return!1}catch(e){return!1}},S=async(e,t,r)=>{f(!0);try{if(!h.isAllowed("login-attempts"))return f(!1),{success:!1,error:"Too many login attempts. Please wait 5 minutes before trying again."};let s=(0,i.o2)(e);if(!s||!t||!r)return f(!1),{success:!1,error:"Email, password, and role are required"};if(!(0,i.B9)(s))return f(!1),{success:!1,error:"Please enter a valid email address"};if(t.length<8)return f(!1),{success:!1,error:"Password must be at least 8 characters long"};let a=await fetch((0,o.E)("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.toLowerCase(),password:t,role:r})}),n=await a.json();if(!a.ok){f(!1);let e=(null==n?void 0:n.message)||(null==n?void 0:n.error)||"Login failed (".concat(a.status,")");return{success:!1,error:e}}if(!n.token||!n.user)return f(!1),{success:!1,error:"Invalid response from server"};{let e=await u(n.user.id,n.user.email);if(e.isBlacklisted)return f(!1),{success:!1,error:"Account access blocked. ".concat(e.reason||"Contact support for assistance.")};let t=i.Bu.setItem(d,n.token),r=i.Bu.setItem(m,JSON.stringify(n.user));if(!t||!r)return f(!1),{success:!1,error:"Failed to securely store session data"};return c({...n.user,token:n.token}),f(!1),h.reset("login-attempts"),{success:!0}}}catch(e){return f(!1),{success:!1,error:e instanceof Error?e.message:"Network error occurred"}}};return(0,s.jsx)(l.Provider,{value:{user:r,login:S,logout:()=>{c(null),i.Bu.removeItem(d),i.Bu.removeItem(m),w.push("/")},isLoading:p,refreshToken:v},children:t})}let f=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},61465:(e,t,r)=>{function s(e){return"string"!=typeof e?"":e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/javascript:/gi,"").replace(/on\w+="[^"]*"/gi,"").replace(/on\w+='[^']*'/gi,"").trim()}function a(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}function n(e){return/^\d{5}(-\d{4})?$/.test(e.trim())}r.d(t,{B9:()=>a,Bu:()=>o,TV:()=>n,o2:()=>s,v$:()=>i});class o{static setItem(e,t){try{if(!window.localStorage)return!1;let r="__storage_test__";return localStorage.setItem(r,"test"),localStorage.removeItem(r),localStorage.setItem(e,t),!0}catch(e){return!1}}static getItem(e){try{if(!window.localStorage)return null;return localStorage.getItem(e)}catch(e){return null}}static removeItem(e){try{if(!window.localStorage)return!1;return localStorage.removeItem(e),!0}catch(e){return!1}}}class i{isAllowed(e){let t=Date.now(),r=(this.attempts.get(e)||[]).filter(e=>t-e<this.windowMs);return!(r.length>=this.maxAttempts)&&(r.push(t),this.attempts.set(e,r),!0)}reset(e){this.attempts.delete(e)}constructor(e=5,t=6e4){this.attempts=new Map,this.maxAttempts=e,this.windowMs=t}}class c{static isUserAgentBlacklisted(e){if(!e)return!1;let t=e.toLowerCase();return!!this.BLOCKED_USER_AGENTS.some(e=>t.includes(e))||this.NEXTJS_PATTERNS.some(t=>t.test(e))}static isDomainBlacklisted(e){if(!e)return!1;try{let t=new URL(e).hostname.toLowerCase();return t.includes("nextjs")||t.includes("vercel")||t.includes("next.js")}catch(r){let t=e.toLowerCase();return t.includes("nextjs")||t.includes("vercel")||t.includes("next.js")}}static addPattern(e){this.NEXTJS_PATTERNS.push(e)}static addUserAgent(e){this.BLOCKED_USER_AGENTS.includes(e.toLowerCase())||this.BLOCKED_USER_AGENTS.push(e.toLowerCase())}}c.NEXTJS_PATTERNS=[/nextjs/i,/next\.js/i,/nextjs-bot/i,/vercel/i],c.BLOCKED_USER_AGENTS=["nextjs","next.js","nextjs-bot","vercel"]},79733:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(95704);let a="https://ondorealestateserver.onrender.com",n=s.env.NEXT_PUBLIC_BACKEND_BASE_URL||a;function o(e){return new URL(e.startsWith("/")?e:"/".concat(e),n||a).toString()}}}]);