(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1164,4181],{6707:(e,t,r)=>{"use strict";r.d(t,{A:()=>h,AuthProvider:()=>d});var s=r(95155),a=r(12115),o=r(20063),n=r(79733),i=r(61465);let u=(0,a.createContext)(void 0),l="ondo_auth_token",c="ondo_user_data",m=new i.v$(5,3e5);function d(e){let{children:t}=e,[r,d]=(0,a.useState)(null),[h,f]=(0,a.useState)(!0),p=(0,o.useRouter)();(0,a.useEffect)(()=>{(async()=>{let e=i.Bu.getItem(l),t=i.Bu.getItem(c);if(e&&t)try{let r=JSON.parse(t);await w(e)?d({...r,token:e}):(i.Bu.removeItem(l),i.Bu.removeItem(c))}catch(e){i.Bu.removeItem(l),i.Bu.removeItem(c)}f(!1)})()},[]);let w=async e=>{try{let t=await fetch((0,n.E)("/api/auth/verify"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!t.ok)return await t.json().catch(()=>({})),!1;return!0}catch(e){return!1}},g=async()=>{let e=i.Bu.getItem(l);if(!e)return!1;try{let t=await fetch((0,n.E)("/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();if(e.token){let t=i.Bu.setItem(l,e.token);return t&&r&&d({...r,token:e.token}),t}}return!1}catch(e){return!1}},v=async(e,t,r)=>{f(!0);try{if(!m.isAllowed("login-attempts"))return f(!1),{success:!1,error:"Too many login attempts. Please wait 5 minutes before trying again."};let s=(0,i.o2)(e);if(!s||!t||!r)return f(!1),{success:!1,error:"Email, password, and role are required"};if(!(0,i.B9)(s))return f(!1),{success:!1,error:"Please enter a valid email address"};if(t.length<8)return f(!1),{success:!1,error:"Password must be at least 8 characters long"};let a=await fetch((0,n.E)("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.toLowerCase(),password:t,role:r})}),o=await a.json();if(!a.ok){f(!1);let e=(null==o?void 0:o.message)||(null==o?void 0:o.error)||"Login failed (".concat(a.status,")");return{success:!1,error:e}}if(!o.token||!o.user)return f(!1),{success:!1,error:"Invalid response from server"};{let e=i.Bu.setItem(l,o.token),t=i.Bu.setItem(c,JSON.stringify(o.user));if(!e||!t)return f(!1),{success:!1,error:"Failed to securely store session data"};return d({...o.user,token:o.token}),f(!1),m.reset("login-attempts"),{success:!0}}}catch(e){return f(!1),{success:!1,error:e instanceof Error?e.message:"Network error occurred"}}};return(0,s.jsx)(u.Provider,{value:{user:r,login:v,logout:()=>{d(null),i.Bu.removeItem(l),i.Bu.removeItem(c),p.push("/")},isLoading:h,refreshToken:g},children:t})}let h=()=>{let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},20063:(e,t,r)=>{"use strict";var s=r(47260);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},35299:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},61465:(e,t,r)=>{"use strict";function s(e){return"string"!=typeof e?"":e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/javascript:/gi,"").replace(/on\w+="[^"]*"/gi,"").replace(/on\w+='[^']*'/gi,"").trim()}function a(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}function o(e){return/^\d{5}(-\d{4})?$/.test(e.trim())}r.d(t,{B9:()=>a,Bu:()=>n,TV:()=>o,o2:()=>s,v$:()=>i});class n{static setItem(e,t){try{if(!window.localStorage)return!1;let r="__storage_test__";return localStorage.setItem(r,"test"),localStorage.removeItem(r),localStorage.setItem(e,t),!0}catch(e){return!1}}static getItem(e){try{if(!window.localStorage)return null;return localStorage.getItem(e)}catch(e){return null}}static removeItem(e){try{if(!window.localStorage)return!1;return localStorage.removeItem(e),!0}catch(e){return!1}}}class i{isAllowed(e){let t=Date.now(),r=(this.attempts.get(e)||[]).filter(e=>t-e<this.windowMs);return!(r.length>=this.maxAttempts)&&(r.push(t),this.attempts.set(e,r),!0)}reset(e){this.attempts.delete(e)}constructor(e=5,t=6e4){this.attempts=new Map,this.maxAttempts=e,this.windowMs=t}}},68176:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var s=r(95155),a=r(12115),o=r(20063),n=r(6707),i=r(35299);function u(e){let{children:t,requiredRole:r}=e,{user:u,isLoading:l}=(0,n.A)(),c=(0,o.useRouter)();return((0,a.useEffect)(()=>{l||u?!l&&r&&(null==u?void 0:u.role)!==r&&((null==u?void 0:u.role)==="tenant"?c.push("/tenant"):(null==u?void 0:u.role)==="owner"?c.push("/owner"):c.push("/")):c.push("/login")},[u,l,c,r]),l)?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})}):!u||r&&u.role!==r?null:(0,s.jsx)(s.Fragment,{children:t})}},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(12115);let a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:u,className:l="",children:c,iconNode:m,...d}=e;return(0,s.createElement)("svg",{ref:t,...o,width:n,height:n,stroke:r,strokeWidth:u?24*Number(i)/Number(n):i,className:a("lucide",l),...d},[...m.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let r=(0,s.forwardRef)((r,o)=>{let{className:i,...u}=r;return(0,s.createElement)(n,{ref:o,iconNode:t,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...u})});return r.displayName="".concat(e),r}},79733:(e,t,r)=>{"use strict";r.d(t,{E:()=>n});var s=r(95704);let a="https://ondorealestateserver.onrender.com",o=s.env.NEXT_PUBLIC_BACKEND_BASE_URL||a;function n(e){return new URL(e.startsWith("/")?e:"/".concat(e),o||a).toString()}},85470:(e,t,r)=>{Promise.resolve().then(r.bind(r,68176)),Promise.resolve().then(r.t.bind(r,52619,23))}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=85470)),_N_E=e.O()}]);